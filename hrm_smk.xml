<ПравилаОбмена>
	<ВерсияФормата РежимСовместимости="">2.01</ВерсияФормата>
	<Ид>5674555b-b59b-48ce-8a1b-3bcf36ca0c08    </Ид>
	<Наименование>ЗарплатаИУправлениеПерсоналомКОРП --&gt; SMK (Ганиев, выгрузка ФЛ) - рефакторинг</Наименование>
	<ДатаВремяСоздания>2016-12-29T11:15:50</ДатаВремяСоздания>
	<Источник ВерсияПлатформы="8.0" ВерсияКонфигурации="2.5.90.1" СинонимКонфигурации="Зарплата и управление персоналом КОРП, редакция 2.5">ЗарплатаИУправлениеПерсоналомКОРП</Источник>
	<Приемник ВерсияПлатформы="8.0" ВерсияКонфигурации="8.02.046" СинонимКонфигурации="Система учета товаров 8.02.046 Торговый Центр">SMK</Приемник>
	<ПередВыгрузкойДанных>ЗаписьЖурналаРегистрации("Обмен данными.ЗУП -&gt; СМК",
	УровеньЖурналаРегистрации.Информация, , ,
	"Начало выгрузки данных по правилам обмена");

СписокОтбор = Новый СписокЗначений;
Запросы.УзлыПланаОбмена.УстановитьПараметр("ЭтотУзел", ПланыОбмена.ВыгрузкаИзКазВЗУП.ЭтотУзел());
РезультатЗапроса = Запросы.УзлыПланаОбмена.Выполнить();
//СписокОтбор.ЗагрузитьЗначения(РезультатЗапроса.Выгрузить().ВыгрузитьКолонку("Ссылка"));
Выборка = РезультатЗапроса.Выбрать();
Набор = РегистрыСведений.СоответствиеОбъектовДляОбмена.СоздатьНаборЗаписей();
Пока Выборка.Следующий() Цикл
	Набор.Отбор.УзелОбмена.Установить(Выборка.Ссылка);
	Набор.Записать(Истина);
КонецЦикла;

ТекИБ = СтрокаСоединенияИнформационнойБазы();
РазрешИБ = нвОбменДаннымиПолныеПраваПовтИсп.ПолучитьЗначениеКонстанты("нвПутьИБКонтрольОбмена");
ТекИБ = СокрЛП(ВРег(ТекИБ));
РазрешИБ = СокрЛП(ВРег(РазрешИБ));
Если ЗначениеЗаполнено(РазрешИБ) И РазрешИБ &lt;&gt; ТекИБ Тогда
	Отказ = Истина;
	ЗаписьЖурналаРегистрации("Обмен данными.УПР -&gt; ФИН",
		УровеньЖурналаРегистрации.Информация, , ,
		"Выгрузка данных отменена. Выгрузка разрешена только в базе: "+РазрешИБ+", текущая база: "+ТекИБ);
КонецЕсли;</ПередВыгрузкойДанных>
	<ПослеВыгрузкиДанных>ЗаписьЖурналаРегистрации("Обмен данными.ЗУП -&gt; СМК",
	УровеньЖурналаРегистрации.Информация, , ,
	"Завершение выгрузки данных по правилам обмена");</ПослеВыгрузкиДанных>
	<ПередЗагрузкойДанных>ЗаписьЖурналаРегистрации("Обмен данными.ЗУП -&gt; СМК",
	УровеньЖурналаРегистрации.Информация, , ,
	"Начало загрузки данных по правилам обмена");

СписокОтбор = Новый СписокЗначений;
Запросы.УзлыПланаОбменаЗагрузка.УстановитьПараметр("ЭтотУзел", ПланыОбмена.ВыгрузкаИзКазВЗУП.ЭтотУзел());
РезультатЗапроса = Запросы.УзлыПланаОбменаЗагрузка.Выполнить();
//СписокОтбор.ЗагрузитьЗначения(РезультатЗапроса.Выгрузить().ВыгрузитьКолонку("Ссылка"));
Выборка = РезультатЗапроса.Выбрать();
Набор = РегистрыСведений.СоответствиеОбъектовДляОбмена.СоздатьНаборЗаписей();
Пока Выборка.Следующий() Цикл
	Набор.Отбор.УзелОбмена.Установить(Выборка.Ссылка);
	Набор.Записать(Истина);
КонецЦикла;</ПередЗагрузкойДанных>
	<ПослеЗагрузкиДанных>ЗаписьЖурналаРегистрации("Обмен данными.ЗУП -&gt; СМК",
	УровеньЖурналаРегистрации.Информация, , ,
	"Завершение загрузки данных по правилам обмена");</ПослеЗагрузкиДанных>
	<Параметры/>
	<Обработки/>
	<ПравилаКонвертацииОбъектов>
		<Группа>
			<Код>Справочники</Код>
			<Наименование>Справочники</Наименование>
			<Порядок>50</Порядок>
			<Правило>
				<Код>Сотрудники</Код>
				<Наименование>Справочник: Физические лица</Наименование>
				<Порядок>50</Порядок>
				<ПередВыгрузкой>ОсновноыеПоля = "ФИО,Должность,АдресПроживания,АдресПоПрописке,ЛицевойСчет,Подразделение,Уволен,Организация,нвСтатусСогласования,нвПредполагаемаяДатаУвольнения,БейджикНомер,БейджикДействует,БейджикПроцентСкидки,БейджикДатаЗаписи";
ВходящиеДанные = Новый Структура("Организации,Телефоны,"+ОсновноыеПоля);
Запросы.ДопДанныеФизлица.УстановитьПараметр("Физлицо", Источник.Ссылка);
РезультатыЗапроса = Запросы.ДопДанныеФизлица.ВыполнитьПакет();

РезультатДопРеквизиты = РезультатыЗапроса[4];
Если НЕ РезультатДопРеквизиты.Пустой() Тогда
	Выборка = РезультатДопРеквизиты.Выбрать();
	Выборка.Следующий();
	ЗаполнитьЗначенияСвойств(ВходящиеДанные, Выборка, ОсновноыеПоля);
КонецЕсли;

// этот цикл надо вынести в алгоритм
РезультатОрганизации = РезультатыЗапроса[5];
Выборка = РезультатОрганизации.Выбрать();
Стр = "";
Пока Выборка.Следующий() Цикл
	Стр = Стр + ?(ПустаяСтрока(Стр), "", ", ") + Выборка.НаименованиеОрганизации;
КонецЦикла;
ВходящиеДанные.Организации = Стр;

РезультатТелефоны = РезультатыЗапроса[6];
Выборка = РезультатТелефоны.Выбрать();
Стр = "";
Пока Выборка.Следующий() Цикл
	Стр = Стр + ?(ПустаяСтрока(Стр), "", ", ") + Выборка.Телефон;
КонецЦикла;
ВходящиеДанные.Телефоны = Стр;

//Выгрузка доп.справочников, необходимых для этого физлица
Если ЗначениеЗаполнено(ВходящиеДанные.Должность) Тогда
	ВыгрузитьПоПравилу(ВходящиеДанные.Должность,,,, "Должности");
КонецЕсли;

Если ЗначениеЗаполнено(Источник.Родитель) Тогда
	ВыгрузитьПоПравилу(Источник.Родитель,,,, "Сотрудники");
КонецЕсли;</ПередВыгрузкой>
				<ПослеВыгрузкиВФайл>Если НЕ Источник.ЭтоГруппа Тогда
	
	// Регистр "ПаспортныеДанные"
	Запросы.ПаспортныеДанные.УстановитьПараметр("ФизЛицо", Источник.Ссылка);
	РезультатЗапроса = Запросы.ПаспортныеДанные.Выполнить();
	
	ИсходящиеДанные = Новый Структура;
	Выборка = РезультатЗапроса.Выбрать();
	Пока Выборка.Следующий() Цикл
		Для Каждого Колонка Из РезультатЗапроса.Колонки Цикл
			ИсходящиеДанные.Вставить(Колонка.Имя, Выборка[Колонка.Имя]);
		КонецЦикла;
		ВыгрузитьПоПравилу( , , ИсходящиеДанные, , "ПаспортныеДанные");
	КонецЦикла;
	
КонецЕсли;</ПослеВыгрузкиВФайл>
				<ПослеЗагрузки>Если НЕ Объект.ЭтоГруппа Тогда
	
	// Обработка новых записей синхронизации
	Если НЕ ЗначениеЗаполнено(Объект.Ссылка) Тогда
		Объект.Записать();
	КонецЕсли;
	
	// создание записи синхронизации
	Запросы.СуществуетЗаписьСинхронизации.УстановитьПараметр("UUID", ПараметрыОбъекта["UUID"]);
	Если Запросы.СуществуетЗаписьСинхронизации.Выполнить().Пустой() Тогда
		// проверка существующих записей по физлицу
		Запросы.СуществуетЗаписьСинхронизацииФизлицо.УстановитьПараметр("Физлицо", Объект.Ссылка);
		РезультатЗапроса = Запросы.СуществуетЗаписьСинхронизацииФизлицо.Выполнить();
		Если НЕ РезультатЗапроса.Пустой() Тогда
			ЗаписьЖурналаРегистрации("Обмен данными.ЗУП -&gt; СМК",
				УровеньЖурналаРегистрации.Ошибка, , ,
				"Отказано в создании записи синхронизации в регистре сведений СоответствиеСотрудников. Уже существует запись по физлицу "+Объект+" ("+Объект.Код+")");
		Иначе
			МенеджерЗаписи = РегистрыСведений.СоответствиеСотрудников.СоздатьМенеджерЗаписи();
			МенеджерЗаписи.UUID = ПараметрыОбъекта["UUID"];
			МенеджерЗаписи.Физлицо = Объект.Ссылка;
			МенеджерЗаписи.Организации = ПараметрыОбъекта["Организации"];
			МенеджерЗаписи.ДатаСинхронизации = ТекущаяДата();
			МенеджерЗаписи.Записать();
			Сообщить("Синхронизирован сотрудник: " + Объект.Ссылка + ", " + ПараметрыОбъекта["UUID"]);
		КонецЕсли;
	КонецЕсли;
	
	// Обработка бейджиков
	Попытка
		Обработки.ЗагрузкаСинхронизацияСотрудников.ОбновитьСведенияОДисконтнойКартеСотрудника(
			Объект.Ссылка,
			ПараметрыОбъекта["БейджикНомер"],
			ПараметрыОбъекта["БейджикДействует"],
			ПараметрыОбъекта["БейджикПроцентСкидки"],
			ПараметрыОбъекта["БейджикДатаЗаписи"]);
	Исключение
	КонецПопытки;
	
КонецЕсли;</ПослеЗагрузки>
				<ПоследовательностьПолейПоиска>Если СвойстваПоиска["ЭтоГруппа"] = Ложь Тогда
	
	Запросы.ФизлицаПоляПоиска.УстановитьПараметр("UUID", ПараметрыОбъекта["UUID"]);
	РезультатЗапроса = Запросы.ФизлицаПоляПоиска.Выполнить();

	Если НЕ РезультатЗапроса.Пустой() Тогда
		Выборка =  РезультатЗапроса.Выбрать();
		Выборка.Следующий();
		Если ЗначениеЗаполнено(Выборка.Физлицо) Тогда
			СсылкаНаОбъект = Выборка.Физлицо;
		КонецЕсли;
	КонецЕсли;

	ПрекратитьПоиск = Истина;
	
КонецЕсли;</ПоследовательностьПолейПоиска>
				<ГенерироватьНовыйНомерИлиКодЕслиНеУказан>true</ГенерироватьНовыйНомерИлиКодЕслиНеУказан>
				<Источник>СправочникСсылка.ФизическиеЛица</Источник>
				<Приемник>СправочникСсылка.Сотрудники</Приемник>
				<Свойства>
					<Свойство Поиск="true">
						<Код>1</Код>
						<Наименование>ДатаРождения --&gt; ДатаРождения</Наименование>
						<Порядок>50</Порядок>
						<Источник Имя="ДатаРождения" Вид="Реквизит" Тип="Дата"/>
						<Приемник Имя="ДатаРождения" Вид="Реквизит" Тип="Дата"/>
					</Свойство>
					<Свойство>
						<Код>2</Код>
						<Наименование>Пол --&gt; Пол</Наименование>
						<Порядок>100</Порядок>
						<Источник Имя="Пол" Вид="Реквизит" Тип="ПеречислениеСсылка.ПолФизическихЛиц"/>
						<Приемник Имя="Пол" Вид="Реквизит" Тип="ПеречислениеСсылка.ПолФизическихЛиц"/>
						<КодПравилаКонвертации>ПолФизическихЛиц                                  </КодПравилаКонвертации>
					</Свойство>
					<Свойство>
						<Код>4</Код>
						<Наименование>Наименование --&gt; Наименование</Наименование>
						<Порядок>200</Порядок>
						<Источник Имя="Наименование" Вид="Свойство" Тип="Строка"/>
						<Приемник Имя="Наименование" Вид="Свойство" Тип="Строка"/>
						<ПередВыгрузкой>Если ЗначениеЗаполнено(ВходящиеДанные.ФИО) Тогда
	Значение = ВходящиеДанные.ФИО;
КонецЕсли;</ПередВыгрузкой>
					</Свойство>
					<Свойство Поиск="true">
						<Код>15</Код>
						<Наименование>Наименование --&gt; ФИО</Наименование>
						<Порядок>250</Порядок>
						<Источник Имя="Наименование" Вид="Свойство" Тип="Строка"/>
						<Приемник Имя="ФИО" Вид="Реквизит" Тип="Строка"/>
						<ПередВыгрузкой>Если ЗначениеЗаполнено(ВходящиеДанные.ФИО) Тогда
	Значение = ВходящиеДанные.ФИО;
КонецЕсли;</ПередВыгрузкой>
					</Свойство>
					<Свойство>
						<Код>5</Код>
						<Наименование>ПометкаУдаления --&gt; ПометкаУдаления</Наименование>
						<Порядок>300</Порядок>
						<Источник Имя="ПометкаУдаления" Вид="Свойство" Тип="Булево"/>
						<Приемник Имя="ПометкаУдаления" Вид="Свойство" Тип="Булево"/>
					</Свойство>
					<Свойство Поиск="true">
						<Код>6</Код>
						<Наименование>Родитель --&gt; Родитель</Наименование>
						<Порядок>350</Порядок>
						<Источник Имя="Родитель" Вид="Свойство" Тип="СправочникСсылка.ФизическиеЛица"/>
						<Приемник Имя="Родитель" Вид="Свойство" Тип="СправочникСсылка.Сотрудники"/>
						<КодПравилаКонвертации>Сотрудники                                        </КодПравилаКонвертации>
					</Свойство>
					<Свойство Поиск="true" Обязательное="true">
						<Код>7</Код>
						<Наименование>ЭтоГруппа --&gt; ЭтоГруппа</Наименование>
						<Порядок>400</Порядок>
						<Источник Имя="ЭтоГруппа" Вид="Свойство" Тип="Булево"/>
						<Приемник Имя="ЭтоГруппа" Вид="Свойство" Тип="Булево"/>
					</Свойство>
					<Свойство Поиск="true">
						<Код>8</Код>
						<Наименование>--&gt; UUID</Наименование>
						<Порядок>450</Порядок>
						<Источник Имя="" Вид=""/>
						<Приемник Имя="" Вид=""/>
						<ИмяПараметраДляПередачи>UUID</ИмяПараметраДляПередачи>
						<ПередВыгрузкой>Значение = Строка(Источник.Ссылка.УникальныйИдентификатор());</ПередВыгрузкой>
					</Свойство>
					<Свойство>
						<Код>10</Код>
						<Наименование>--&gt; Организации</Наименование>
						<Порядок>500</Порядок>
						<ПолучитьИзВходящихДанных>true</ПолучитьИзВходящихДанных>
						<Источник Имя="" Вид=""/>
						<Приемник Имя="" Вид=""/>
						<ИмяПараметраДляПередачи>Организации</ИмяПараметраДляПередачи>
					</Свойство>
					<Свойство>
						<Код>9</Код>
						<Наименование>--&gt; Должность</Наименование>
						<Порядок>550</Порядок>
						<ПолучитьИзВходящихДанных>true</ПолучитьИзВходящихДанных>
						<Источник Имя="" Вид=""/>
						<Приемник Имя="Должность" Вид="Реквизит" Тип="СправочникСсылка.Должности"/>
						<КодПравилаКонвертации>Должности                                         </КодПравилаКонвертации>
					</Свойство>
					<Свойство>
						<Код>11</Код>
						<Наименование>--&gt; АдресПроживания</Наименование>
						<Порядок>600</Порядок>
						<ПолучитьИзВходящихДанных>true</ПолучитьИзВходящихДанных>
						<Источник Имя="" Вид=""/>
						<Приемник Имя="АдресПроживания" Вид="Реквизит" Тип="Строка"/>
					</Свойство>
					<Свойство>
						<Код>12</Код>
						<Наименование>--&gt; АдресПоПрописке</Наименование>
						<Порядок>650</Порядок>
						<ПолучитьИзВходящихДанных>true</ПолучитьИзВходящихДанных>
						<Источник Имя="" Вид=""/>
						<Приемник Имя="АдресПоПрописке" Вид="Реквизит" Тип="Строка"/>
					</Свойство>
					<Свойство>
						<Код>13</Код>
						<Наименование>--&gt; Телефоны</Наименование>
						<Порядок>700</Порядок>
						<ПолучитьИзВходящихДанных>true</ПолучитьИзВходящихДанных>
						<Источник Имя="" Вид=""/>
						<Приемник Имя="Телефоны" Вид="Реквизит" Тип="Строка"/>
					</Свойство>
					<Свойство>
						<Код>14</Код>
						<Наименование>--&gt; ЛицевойСчет</Наименование>
						<Порядок>750</Порядок>
						<ПолучитьИзВходящихДанных>true</ПолучитьИзВходящихДанных>
						<Источник Имя="" Вид=""/>
						<Приемник Имя="ЛицевойСчет" Вид="Реквизит" Тип="Строка"/>
					</Свойство>
					<Свойство>
						<Код>16</Код>
						<Наименование>--&gt; Подразделение</Наименование>
						<Порядок>800</Порядок>
						<ПолучитьИзВходящихДанных>true</ПолучитьИзВходящихДанных>
						<Источник Имя="" Вид=""/>
						<Приемник Имя="Подразделение" Вид="Реквизит" Тип="Строка"/>
					</Свойство>
					<Свойство>
						<Код>17</Код>
						<Наименование>--&gt; Уволен</Наименование>
						<Порядок>850</Порядок>
						<ПолучитьИзВходящихДанных>true</ПолучитьИзВходящихДанных>
						<Источник Имя="" Вид=""/>
						<Приемник Имя="Уволен" Вид="Реквизит" Тип="Булево"/>
					</Свойство>
					<Свойство>
						<Код>18</Код>
						<Наименование>--&gt; Организация</Наименование>
						<Порядок>900</Порядок>
						<ПолучитьИзВходящихДанных>true</ПолучитьИзВходящихДанных>
						<Источник Имя="" Вид=""/>
						<Приемник Имя="Организация" Вид="Реквизит" Тип="СправочникСсылка.Организации"/>
						<КодПравилаКонвертации>Организации                                       </КодПравилаКонвертации>
					</Свойство>
					<Свойство>
						<Код>19</Код>
						<Наименование>--&gt; нвСтатусСогласования</Наименование>
						<Порядок>950</Порядок>
						<ПолучитьИзВходящихДанных>true</ПолучитьИзВходящихДанных>
						<Источник Имя="" Вид=""/>
						<Приемник Имя="нвСтатусСогласования" Вид="Реквизит" Тип="ПеречислениеСсылка.нвСтатусыСогласованияОбходногоЛиста"/>
						<КодПравилаКонвертации>нвСтатусыСогласованияОбходногоЛиста               </КодПравилаКонвертации>
					</Свойство>
					<Свойство>
						<Код>20</Код>
						<Наименование>--&gt; нвПредполагаемаяДатаУвольнения</Наименование>
						<Порядок>1000</Порядок>
						<ПолучитьИзВходящихДанных>true</ПолучитьИзВходящихДанных>
						<Источник Имя="" Вид=""/>
						<Приемник Имя="нвПредполагаемаяДатаУвольнения" Вид="Реквизит" Тип="Дата"/>
					</Свойство>
					<Свойство>
						<Код>21</Код>
						<Наименование>--&gt; БейджикНомер</Наименование>
						<Порядок>1050</Порядок>
						<ПолучитьИзВходящихДанных>true</ПолучитьИзВходящихДанных>
						<Источник Имя="" Вид=""/>
						<Приемник Имя="" Вид=""/>
						<ИмяПараметраДляПередачи>БейджикНомер</ИмяПараметраДляПередачи>
					</Свойство>
					<Свойство>
						<Код>22</Код>
						<Наименование>--&gt; БейджикДействует</Наименование>
						<Порядок>1100</Порядок>
						<ПолучитьИзВходящихДанных>true</ПолучитьИзВходящихДанных>
						<Источник Имя="" Вид=""/>
						<Приемник Имя="" Вид=""/>
						<ИмяПараметраДляПередачи>БейджикДействует</ИмяПараметраДляПередачи>
					</Свойство>
					<Свойство>
						<Код>23</Код>
						<Наименование>--&gt; БейджикПроцентСкидки</Наименование>
						<Порядок>1150</Порядок>
						<ПолучитьИзВходящихДанных>true</ПолучитьИзВходящихДанных>
						<Источник Имя="" Вид=""/>
						<Приемник Имя="" Вид=""/>
						<ИмяПараметраДляПередачи>БейджикПроцентСкидки</ИмяПараметраДляПередачи>
					</Свойство>
					<Свойство>
						<Код>24</Код>
						<Наименование>--&gt; БейджикДатаЗаписи</Наименование>
						<Порядок>1200</Порядок>
						<ПолучитьИзВходящихДанных>true</ПолучитьИзВходящихДанных>
						<Источник Имя="" Вид=""/>
						<Приемник Имя="" Вид=""/>
						<ИмяПараметраДляПередачи>БейджикДатаЗаписи</ИмяПараметраДляПередачи>
					</Свойство>
				</Свойства>
				<Значения/>
			</Правило>
			<Правило>
				<Код>Должности</Код>
				<Наименование>Справочник: Должности</Наименование>
				<Порядок>100</Порядок>
				<СинхронизироватьПоИдентификатору>true</СинхронизироватьПоИдентификатору>
				<Источник>СправочникСсылка.ДолжностиОрганизаций</Источник>
				<Приемник>СправочникСсылка.Должности</Приемник>
				<Свойства>
					<Свойство>
						<Код>1</Код>
						<Наименование>Код --&gt; Код</Наименование>
						<Порядок>50</Порядок>
						<Источник Имя="Код" Вид="Свойство" Тип="Строка"/>
						<Приемник Имя="Код" Вид="Свойство" Тип="Строка"/>
					</Свойство>
					<Свойство>
						<Код>2</Код>
						<Наименование>Наименование --&gt; Наименование</Наименование>
						<Порядок>100</Порядок>
						<Источник Имя="Наименование" Вид="Свойство" Тип="Строка"/>
						<Приемник Имя="Наименование" Вид="Свойство" Тип="Строка"/>
					</Свойство>
					<Свойство>
						<Код>3</Код>
						<Наименование>ПометкаУдаления --&gt; ПометкаУдаления</Наименование>
						<Порядок>150</Порядок>
						<Источник Имя="ПометкаУдаления" Вид="Свойство" Тип="Булево"/>
						<Приемник Имя="ПометкаУдаления" Вид="Свойство" Тип="Булево"/>
					</Свойство>
				</Свойства>
				<Значения/>
			</Правило>
			<Правило>
				<Код>Организации</Код>
				<Наименование>Справочник: Организации</Наименование>
				<Порядок>150</Порядок>
				<ПоследовательностьПолейПоиска>Если СвойстваПоиска["ЭтоГруппа"] = Истина Тогда
	// Если объект - группа, то поиск идёт по Наименованию
	СтрокаИменСвойствПоиска = "Наименование";
ИначеЕсли ЗначениеЗаполнено(СвойстваПоиска["ИНН"]) Тогда
	// Если объект - элемент и у него заполнен реквизит ИНН
	Если НомерВариантаПоиска = 1 Тогда
		СтрокаИменСвойствПоиска = "ИНН,КПП,Наименование,ЭтоГруппа";	
	ИначеЕсли НомерВариантаПоиска = 2 Тогда
		СтрокаИменСвойствПоиска = "ИНН,КПП,ЭтоГруппа";	
	ИначеЕсли НомерВариантаПоиска = 3 Тогда
		СтрокаИменСвойствПоиска = "ИНН,ЭтоГруппа";
	Иначе
		СтрокаИменСвойствПоиска = "Наименование,ЭтоГруппа";
	КонецЕсли;
Иначе
	// Если реквизит ИНН не заполнен, то производим поиск по Наименованию
	СтрокаИменСвойствПоиска = "Наименование,ЭтоГруппа";
КонецЕсли;</ПоследовательностьПолейПоиска>
				<НеЗамещать>true</НеЗамещать>
				<СинхронизироватьПоИдентификатору>true</СинхронизироватьПоИдентификатору>
				<ПродолжитьПоискПоПолямПоискаЕслиПоИдентификаторуНеНашли>true</ПродолжитьПоискПоПолямПоискаЕслиПоИдентификаторуНеНашли>
				<НеСоздаватьЕслиНеНайден>true</НеСоздаватьЕслиНеНайден>
				<ПриПереносеОбъектаПоСсылкеУстанавливатьТолькоGIUD>true</ПриПереносеОбъектаПоСсылкеУстанавливатьТолькоGIUD>
				<Источник>СправочникСсылка.Организации</Источник>
				<Приемник>СправочникСсылка.Организации</Приемник>
				<Свойства>
					<Свойство Поиск="true">
						<Код>1</Код>
						<Наименование>ИНН --&gt; ИНН</Наименование>
						<Порядок>50</Порядок>
						<Источник Имя="ИНН" Вид="Реквизит" Тип="Строка"/>
						<Приемник Имя="ИНН" Вид="Реквизит" Тип="Строка"/>
					</Свойство>
					<Свойство>
						<Код>2</Код>
						<Наименование>КодПоОКПО --&gt; КодПоОКПО</Наименование>
						<Порядок>100</Порядок>
						<Источник Имя="КодПоОКПО" Вид="Реквизит" Тип="Строка"/>
						<Приемник Имя="КодПоОКПО" Вид="Реквизит" Тип="Строка"/>
					</Свойство>
					<Свойство Поиск="true">
						<Код>3</Код>
						<Наименование>КПП --&gt; КПП</Наименование>
						<Порядок>150</Порядок>
						<Источник Имя="КПП" Вид="Реквизит" Тип="Строка"/>
						<Приемник Имя="КПП" Вид="Реквизит" Тип="Строка"/>
					</Свойство>
					<Свойство>
						<Код>4</Код>
						<Наименование>ОГРН --&gt; ОГРН</Наименование>
						<Порядок>200</Порядок>
						<Источник Имя="ОГРН" Вид="Реквизит" Тип="Строка"/>
						<Приемник Имя="ОГРН" Вид="Реквизит" Тип="Строка"/>
					</Свойство>
					<Свойство>
						<Код>5</Код>
						<Наименование>Код --&gt; Код</Наименование>
						<Порядок>250</Порядок>
						<Источник Имя="Код" Вид="Свойство" Тип="Строка"/>
						<Приемник Имя="Код" Вид="Свойство" Тип="Строка"/>
						<ПриводитьКДлине>5</ПриводитьКДлине>
					</Свойство>
					<Свойство Поиск="true">
						<Код>6</Код>
						<Наименование>Наименование --&gt; Наименование</Наименование>
						<Порядок>300</Порядок>
						<Источник Имя="Наименование" Вид="Свойство" Тип="Строка"/>
						<Приемник Имя="Наименование" Вид="Свойство" Тип="Строка"/>
					</Свойство>
					<Свойство>
						<Код>7</Код>
						<Наименование>ПометкаУдаления --&gt; ПометкаУдаления</Наименование>
						<Порядок>350</Порядок>
						<Источник Имя="ПометкаУдаления" Вид="Свойство" Тип="Булево"/>
						<Приемник Имя="ПометкаУдаления" Вид="Свойство" Тип="Булево"/>
					</Свойство>
					<Свойство Поиск="true" Обязательное="true">
						<Код>8</Код>
						<Наименование>--&gt; ЭтоГруппа</Наименование>
						<Порядок>400</Порядок>
						<Источник Имя="" Вид=""/>
						<Приемник Имя="ЭтоГруппа" Вид="Свойство" Тип="Булево"/>
						<ПередВыгрузкой>Значение = Ложь;</ПередВыгрузкой>
					</Свойство>
				</Свойства>
				<Значения/>
			</Правило>
		</Группа>
		<Группа>
			<Код>Перечисления</Код>
			<Наименование>Перечисления</Наименование>
			<Порядок>100</Порядок>
			<Правило>
				<Код>ПолФизическихЛиц</Код>
				<Наименование>Перечисление: Пол физических Лиц</Наименование>
				<Порядок>50</Порядок>
				<Источник>ПеречислениеСсылка.ПолФизическихЛиц</Источник>
				<Приемник>ПеречислениеСсылка.ПолФизическихЛиц</Приемник>
				<Свойства/>
				<Значения>
					<Значение>
						<Код>1</Код>
						<Наименование>Женский --&gt; Женский</Наименование>
						<Порядок>50</Порядок>
						<Источник>Женский</Источник>
						<Приемник>Женский</Приемник>
					</Значение>
					<Значение>
						<Код>2</Код>
						<Наименование>Мужской --&gt; Мужской</Наименование>
						<Порядок>100</Порядок>
						<Источник>Мужской</Источник>
						<Приемник>Мужской</Приемник>
					</Значение>
				</Значения>
			</Правило>
			<Правило>
				<Код>нвСтатусыСогласованияОбходногоЛиста</Код>
				<Наименование>Перечисление: Статусы согласования обходного листа</Наименование>
				<Порядок>100</Порядок>
				<Источник>ПеречислениеСсылка.нвСтатусыСогласованияОбходногоЛиста</Источник>
				<Приемник>ПеречислениеСсылка.нвСтатусыСогласованияОбходногоЛиста</Приемник>
				<Свойства/>
				<Значения>
					<Значение>
						<Код>1</Код>
						<Наименование>Зарегистрирован --&gt; НаСогласовании</Наименование>
						<Порядок>50</Порядок>
						<Источник>Зарегистрирован</Источник>
						<Приемник>НаСогласовании</Приемник>
					</Значение>
					<Значение>
						<Код>2</Код>
						<Наименование>Исполнен --&gt; Согласован</Наименование>
						<Порядок>100</Порядок>
						<Источник>Исполнен</Источник>
						<Приемник>Согласован</Приемник>
					</Значение>
					<Значение>
						<Код>3</Код>
						<Наименование>НаИсполнении --&gt; НаСогласовании</Наименование>
						<Порядок>150</Порядок>
						<Источник>НаИсполнении</Источник>
						<Приемник>НаСогласовании</Приемник>
					</Значение>
					<Значение>
						<Код>4</Код>
						<Наименование>НаРассмотрении --&gt; НаСогласовании</Наименование>
						<Порядок>200</Порядок>
						<Источник>НаРассмотрении</Источник>
						<Приемник>НаСогласовании</Приемник>
					</Значение>
					<Значение>
						<Код>5</Код>
						<Наименование>НаРегистрации --&gt; НаСогласовании</Наименование>
						<Порядок>250</Порядок>
						<Источник>НаРегистрации</Источник>
						<Приемник>НаСогласовании</Приемник>
					</Значение>
					<Значение>
						<Код>6</Код>
						<Наименование>НаСогласовании --&gt; НаСогласовании</Наименование>
						<Порядок>300</Порядок>
						<Источник>НаСогласовании</Источник>
						<Приемник>НаСогласовании</Приемник>
					</Значение>
					<Значение>
						<Код>7</Код>
						<Наименование>НаУтверждении --&gt; НаСогласовании</Наименование>
						<Порядок>350</Порядок>
						<Источник>НаУтверждении</Источник>
						<Приемник>НаСогласовании</Приемник>
					</Значение>
					<Значение>
						<Код>8</Код>
						<Наименование>НВ_Поступление_ВыгруженВБухОС --&gt; Согласован</Наименование>
						<Порядок>400</Порядок>
						<Источник>НВ_Поступление_ВыгруженВБухОС</Источник>
						<Приемник>Согласован</Приемник>
					</Значение>
					<Значение>
						<Код>9</Код>
						<Наименование>НВ_Поступление_НеВыгруженВБухОС --&gt; НаСогласовании</Наименование>
						<Порядок>450</Порядок>
						<Источник>НВ_Поступление_НеВыгруженВБухОС</Источник>
						<Приемник>НаСогласовании</Приемник>
					</Значение>
					<Значение>
						<Код>10</Код>
						<Наименование>НеЗарегистрирован --&gt; НаСогласовании</Наименование>
						<Порядок>500</Порядок>
						<Источник>НеЗарегистрирован</Источник>
						<Приемник>НаСогласовании</Приемник>
					</Значение>
					<Значение>
						<Код>11</Код>
						<Наименование>НеСогласован --&gt; НаСогласовании</Наименование>
						<Порядок>550</Порядок>
						<Источник>НеСогласован</Источник>
						<Приемник>НаСогласовании</Приемник>
					</Значение>
					<Значение>
						<Код>12</Код>
						<Наименование>НеУтвержден --&gt; НаСогласовании</Наименование>
						<Порядок>600</Порядок>
						<Источник>НеУтвержден</Источник>
						<Приемник>НаСогласовании</Приемник>
					</Значение>
					<Значение>
						<Код>13</Код>
						<Наименование>Проект --&gt; НаСогласовании</Наименование>
						<Порядок>650</Порядок>
						<Источник>Проект</Источник>
						<Приемник>НаСогласовании</Приемник>
					</Значение>
					<Значение>
						<Код>14</Код>
						<Наименование>Рассмотрен --&gt; Согласован</Наименование>
						<Порядок>700</Порядок>
						<Источник>Рассмотрен</Источник>
						<Приемник>Согласован</Приемник>
					</Значение>
					<Значение>
						<Код>15</Код>
						<Наименование>Согласован --&gt; Согласован</Наименование>
						<Порядок>750</Порядок>
						<Источник>Согласован</Источник>
						<Приемник>Согласован</Приемник>
					</Значение>
					<Значение>
						<Код>16</Код>
						<Наименование>Утвержден --&gt; Согласован</Наименование>
						<Порядок>800</Порядок>
						<Источник>Утвержден</Источник>
						<Приемник>Согласован</Приемник>
					</Значение>
				</Значения>
			</Правило>
		</Группа>
		<Группа>
			<Код>Регистры сведений</Код>
			<Наименование>Регистры сведений</Наименование>
			<Порядок>150</Порядок>
			<Правило>
				<Код>ПаспортныеДанные</Код>
				<Наименование>: </Наименование>
				<Порядок>50</Порядок>
				<НеЗапоминатьВыгруженные>true</НеЗапоминатьВыгруженные>
				<Приемник>РегистрСведенийЗапись.ПаспортныеДанные</Приемник>
				<Свойства>
					<Свойство>
						<Код>1</Код>
						<Наименование>--&gt; Объект</Наименование>
						<Порядок>50</Порядок>
						<ПолучитьИзВходящихДанных>true</ПолучитьИзВходящихДанных>
						<Источник Имя="" Вид=""/>
						<Приемник Имя="Объект" Вид="Измерение"/>
						<КодПравилаКонвертации>Сотрудники                                        </КодПравилаКонвертации>
					</Свойство>
					<Свойство>
						<Код>2</Код>
						<Наименование>--&gt; ДатаВыдачиПаспорта</Наименование>
						<Порядок>100</Порядок>
						<ПолучитьИзВходящихДанных>true</ПолучитьИзВходящихДанных>
						<Источник Имя="" Вид=""/>
						<Приемник Имя="ДатаВыдачиПаспорта" Вид="Ресурс" Тип="Дата"/>
					</Свойство>
					<Свойство>
						<Код>3</Код>
						<Наименование>--&gt; ДатаРегистрацииПоМестуЖительства</Наименование>
						<Порядок>150</Порядок>
						<ПолучитьИзВходящихДанных>true</ПолучитьИзВходящихДанных>
						<Источник Имя="" Вид=""/>
						<Приемник Имя="ДатаРегистрацииПоМестуЖительства" Вид="Ресурс" Тип="Дата"/>
					</Свойство>
					<Свойство>
						<Код>4</Код>
						<Наименование>--&gt; ДокументКодПодразделения</Наименование>
						<Порядок>200</Порядок>
						<ПолучитьИзВходящихДанных>true</ПолучитьИзВходящихДанных>
						<Источник Имя="" Вид=""/>
						<Приемник Имя="ДокументКодПодразделения" Вид="Ресурс" Тип="Строка"/>
					</Свойство>
					<Свойство>
						<Код>5</Код>
						<Наименование>--&gt; КемВыданПаспорт</Наименование>
						<Порядок>250</Порядок>
						<ПолучитьИзВходящихДанных>true</ПолучитьИзВходящихДанных>
						<Источник Имя="" Вид=""/>
						<Приемник Имя="КемВыданПаспорт" Вид="Ресурс" Тип="Строка"/>
					</Свойство>
					<Свойство>
						<Код>6</Код>
						<Наименование>--&gt; НомерПаспорта</Наименование>
						<Порядок>300</Порядок>
						<ПолучитьИзВходящихДанных>true</ПолучитьИзВходящихДанных>
						<Источник Имя="" Вид=""/>
						<Приемник Имя="НомерПаспорта" Вид="Ресурс" Тип="Строка"/>
					</Свойство>
					<Свойство>
						<Код>7</Код>
						<Наименование>--&gt; СерияПаспорта</Наименование>
						<Порядок>350</Порядок>
						<ПолучитьИзВходящихДанных>true</ПолучитьИзВходящихДанных>
						<Источник Имя="" Вид=""/>
						<Приемник Имя="СерияПаспорта" Вид="Ресурс" Тип="Строка"/>
					</Свойство>
				</Свойства>
				<Значения/>
			</Правило>
		</Группа>
	</ПравилаКонвертацииОбъектов>
	<ПравилаВыгрузкиДанных>
		<Группа Отключить="false">
			<Код>Справочники</Код>
			<Наименование>Справочники</Наименование>
			<Порядок>50</Порядок>
			<Правило Отключить="false">
				<Код>Сотрудники</Код>
				<Наименование>Сотрудники                                        </Наименование>
				<Порядок>50</Порядок>
				<КодПравилаКонвертации>Сотрудники                                        </КодПравилаКонвертации>
				<СпособОтбораДанных>СтандартнаяВыборка</СпособОтбораДанных>
				<ОбъектВыборки>СправочникСсылка.ФизическиеЛица</ОбъектВыборки>
			</Правило>
			<Правило Отключить="false">
				<Код>СотрудникиОрганизаций</Код>
				<Наименование>Сотрудники</Наименование>
				<Порядок>100</Порядок>
				<КодПравилаКонвертации>Сотрудники                                        </КодПравилаКонвертации>
				<СпособОтбораДанных>СтандартнаяВыборка</СпособОтбораДанных>
				<ОбъектВыборки>СправочникСсылка.СотрудникиОрганизаций</ОбъектВыборки>
				<ПередВыгрузкойОбъекта>Объект = Объект.Физлицо;</ПередВыгрузкойОбъекта>
			</Правило>
		</Группа>
		<Группа Отключить="false">
			<Код>РегистрыСведений</Код>
			<Наименование>РегистрыСведений</Наименование>
			<Порядок>100</Порядок>
			<Правило Отключить="false">
				<Код>нвСтатусыОбходногоЛистаСотрудников</Код>
				<Наименование>Статусы обходного листа сотрудников (Невада)</Наименование>
				<Порядок>50</Порядок>
				<КодПравилаКонвертации>Сотрудники                                        </КодПравилаКонвертации>
				<СпособОтбораДанных>СтандартнаяВыборка</СпособОтбораДанных>
				<ОбъектВыборки>РегистрСведенийЗапись.нвСтатусыОбходногоЛистаСотрудников</ОбъектВыборки>
				<ПередВыгрузкойОбъекта>Если ТипЗнч(Объект) = Тип("РегистрСведенийНаборЗаписей.нвСтатусыОбходногоЛистаСотрудников") Тогда
	Для Каждого ЗаписьРег Из Объект Цикл
		ВыгрузитьПоПравилу(ЗаписьРег.Сотрудник.Физлицо,,,,"Сотрудники");
	КонецЦикла;
	Отказ = Истина;
ИначеЕсли ТипЗнч(Объект) = Тип("РегистрСведенийЗапись.нвСтатусыОбходногоЛистаСотрудников") Тогда
	Объект = Объект.Сотрудник.Физлицо;
КонецЕсли;</ПередВыгрузкойОбъекта>
			</Правило>
		</Группа>
	</ПравилаВыгрузкиДанных>
	<ПравилаОчисткиДанных/>
	<Алгоритмы/>
	<Запросы>
		<Запрос Имя="ДопДанныеФизлица" ИспользуетсяПриЗагрузке="false">
			<Текст>ВЫБРАТЬ РАЗРЕШЕННЫЕ
	ВложенныйЗапрос.Сотрудник,
	ФизическиеЛица.Ссылка КАК Физлицо,
	ВложенныйЗапрос.ВидЗанятости,
	ВложенныйЗапрос.Должность,
	ВложенныйЗапрос.Организация,
	ВложенныйЗапрос.ПричинаИзменения,
	ВложенныйЗапрос.Подразделение,
	ЕСТЬNULL(ВложенныйЗапрос.Сотрудник.нвОрганизацияФИН, ЗНАЧЕНИЕ(Справочник.Организации.ПустаяСсылка)) КАК ОрганизацияФИН
ПОМЕСТИТЬ МестаРаботыФизлица
ИЗ
	Справочник.ФизическиеЛица КАК ФизическиеЛица
		ЛЕВОЕ СОЕДИНЕНИЕ (ВЫБРАТЬ
			РаботникиСрез.Сотрудник КАК Сотрудник,
			РаботникиСрез.Сотрудник.Физлицо КАК Физлицо,
			РаботникиСрез.Сотрудник.ВидЗанятости КАК ВидЗанятости,
			РаботникиСрез.Должность КАК Должность,
			РаботникиСрез.ОбособленноеПодразделение КАК Организация,
			РаботникиСрез.ПричинаИзмененияСостояния КАК ПричинаИзменения,
			РаботникиСрез.ПодразделениеОрганизации КАК Подразделение
		ИЗ
			РегистрСведений.РаботникиОрганизаций.СрезПоследних(, Сотрудник.Физлицо = &amp;Физлицо) КАК РаботникиСрез
		
		ОБЪЕДИНИТЬ ВСЕ
		
		ВЫБРАТЬ
			РаботникиСрез.Сотрудник,
			РаботникиСрез.Сотрудник.Физлицо,
			РаботникиСрез.Сотрудник.ВидЗанятости,
			РаботникиСрез.ДолжностьЗавершения,
			РаботникиСрез.ОбособленноеПодразделениеЗавершения,
			РаботникиСрез.ПричинаИзмененияСостоянияЗавершения,
			РаботникиСрез.ПодразделениеОрганизацииЗавершения
		ИЗ
			РегистрСведений.РаботникиОрганизаций.СрезПоследних(, Сотрудник.Физлицо = &amp;Физлицо) КАК РаботникиСрез
		ГДЕ
			РаботникиСрез.ПериодЗавершения &lt;&gt; ДАТАВРЕМЯ(1, 1, 1, 0, 0, 0)) КАК ВложенныйЗапрос
		ПО (ВложенныйЗапрос.Физлицо = ФизическиеЛица.Ссылка)
ГДЕ
	ФизическиеЛица.Ссылка = &amp;Физлицо
;

////////////////////////////////////////////////////////////////////////////////
ВЫБРАТЬ
	ЛицевыеСчета.ФизЛицо,
	ЛицевыеСчета.Организация,
	ЛицевыеСчета.НомерЛицевогоСчета,
	ЕСТЬNULL(ПоследниеВыплаты.Период, ДАТАВРЕМЯ(1, 1, 1, 0, 0, 0)) КАК ДатаПоследнейВыплаты
ПОМЕСТИТЬ ЛицевыеСчетаФизлица
ИЗ
	(ВЫБРАТЬ
		ЛицевыеСчетаРаботниковОрганизации.Организация КАК Организация,
		ЛицевыеСчетаРаботниковОрганизации.Банк КАК Банк,
		ЛицевыеСчетаРаботниковОрганизации.ФизЛицо КАК ФизЛицо,
		ЛицевыеСчетаРаботниковОрганизации.НомерЛицевогоСчета КАК НомерЛицевогоСчета
	ИЗ
		РегистрСведений.ЛицевыеСчетаРаботниковОрганизации КАК ЛицевыеСчетаРаботниковОрганизации
	ГДЕ
		ЛицевыеСчетаРаботниковОрганизации.ФизЛицо = &amp;Физлицо
		И ЛицевыеСчетаРаботниковОрганизации.НомерЛицевогоСчета &lt;&gt; "") КАК ЛицевыеСчета
		ЛЕВОЕ СОЕДИНЕНИЕ (ВЫБРАТЬ
			МАКСИМУМ(ЗарплатаЗаМесяцОрганизаций.Период) КАК Период,
			ВЫРАЗИТЬ(ЗарплатаЗаМесяцОрганизаций.Регистратор КАК Документ.ЗарплатаКВыплатеОрганизаций).Банк КАК Банк,
			ЗарплатаЗаМесяцОрганизаций.Организация КАК Организация,
			ЗарплатаЗаМесяцОрганизаций.Физлицо КАК Физлицо
		ИЗ
			РегистрНакопления.ЗарплатаЗаМесяцОрганизаций КАК ЗарплатаЗаМесяцОрганизаций
		ГДЕ
			ЗарплатаЗаМесяцОрганизаций.Физлицо = &amp;Физлицо
			И ЗарплатаЗаМесяцОрганизаций.Регистратор ССЫЛКА Документ.ЗарплатаКВыплатеОрганизаций
			И ЗарплатаЗаМесяцОрганизаций.ВидДвижения = ЗНАЧЕНИЕ(ВидДвиженияНакопления.Расход)
			И ВЫРАЗИТЬ(ЗарплатаЗаМесяцОрганизаций.Регистратор КАК Документ.ЗарплатаКВыплатеОрганизаций).СпособВыплаты = ЗНАЧЕНИЕ(Перечисление.СпособыВыплатыЗарплаты.ЧерезБанк)
		
		СГРУППИРОВАТЬ ПО
			ВЫРАЗИТЬ(ЗарплатаЗаМесяцОрганизаций.Регистратор КАК Документ.ЗарплатаКВыплатеОрганизаций).Банк,
			ЗарплатаЗаМесяцОрганизаций.Организация,
			ЗарплатаЗаМесяцОрганизаций.Физлицо) КАК ПоследниеВыплаты
		ПО ЛицевыеСчета.Организация = ПоследниеВыплаты.Организация
			И ЛицевыеСчета.ФизЛицо = ПоследниеВыплаты.Физлицо
			И ЛицевыеСчета.Банк = ПоследниеВыплаты.Банк
;

////////////////////////////////////////////////////////////////////////////////
ВЫБРАТЬ
	ЛицевыеСчетаФизлица.ФизЛицо,
	ЛицевыеСчетаФизлица.Организация,
	ЛицевыеСчетаФизлица.НомерЛицевогоСчета
ПОМЕСТИТЬ ЛицевойСчетФизлицоОрганизация
ИЗ
	ЛицевыеСчетаФизлица КАК ЛицевыеСчетаФизлица
		ВНУТРЕННЕЕ СОЕДИНЕНИЕ (ВЫБРАТЬ
			ЛицевыеСчетаФизлица.ФизЛицо КАК ФизЛицо,
			ЛицевыеСчетаФизлица.Организация КАК Организация,
			МАКСИМУМ(ЛицевыеСчетаФизлица.ДатаПоследнейВыплаты) КАК ДатаПоследнейВыплаты
		ИЗ
			ЛицевыеСчетаФизлица КАК ЛицевыеСчетаФизлица
		
		СГРУППИРОВАТЬ ПО
			ЛицевыеСчетаФизлица.ФизЛицо,
			ЛицевыеСчетаФизлица.Организация) КАК ПоследниеДвиженияПоОрганизациям
		ПО ЛицевыеСчетаФизлица.ФизЛицо = ПоследниеДвиженияПоОрганизациям.ФизЛицо
			И ЛицевыеСчетаФизлица.Организация = ПоследниеДвиженияПоОрганизациям.Организация
			И ЛицевыеСчетаФизлица.ДатаПоследнейВыплаты = ПоследниеДвиженияПоОрганизациям.ДатаПоследнейВыплаты
;

////////////////////////////////////////////////////////////////////////////////
ВЫБРАТЬ
	ЛицевыеСчетаФизлица.ФизЛицо,
	ЛицевыеСчетаФизлица.НомерЛицевогоСчета
ПОМЕСТИТЬ ЛицевойСчетФизлицо
ИЗ
	ЛицевыеСчетаФизлица КАК ЛицевыеСчетаФизлица
		ВНУТРЕННЕЕ СОЕДИНЕНИЕ (ВЫБРАТЬ
			ЛицевыеСчетаФизлица.ФизЛицо КАК ФизЛицо,
			МАКСИМУМ(ЛицевыеСчетаФизлица.ДатаПоследнейВыплаты) КАК ДатаПоследнейВыплаты
		ИЗ
			ЛицевыеСчетаФизлица КАК ЛицевыеСчетаФизлица
		
		СГРУППИРОВАТЬ ПО
			ЛицевыеСчетаФизлица.ФизЛицо) КАК ПоследниеДвиженияПоОрганизациям
		ПО ЛицевыеСчетаФизлица.ФизЛицо = ПоследниеДвиженияПоОрганизациям.ФизЛицо
			И ЛицевыеСчетаФизлица.ДатаПоследнейВыплаты = ПоследниеДвиженияПоОрганизациям.ДатаПоследнейВыплаты
;

////////////////////////////////////////////////////////////////////////////////
ВЫБРАТЬ РАЗРЕШЕННЫЕ ПЕРВЫЕ 1
	ВЫБОР
		КОГДА МестаРаботыФизлица.Сотрудник.ПометкаУдаления
				ИЛИ НЕ МестаРаботыФизлица.Сотрудник.Актуальность
			ТОГДА 2
		ИНАЧЕ 1
	КОНЕЦ КАК ПриоритетАктуальность,
	ВЫБОР
		КОГДА МестаРаботыФизлица.ПричинаИзменения = ЗНАЧЕНИЕ(Перечисление.ПричиныИзмененияСостояния.Увольнение)
			ТОГДА 2
		ИНАЧЕ 1
	КОНЕЦ КАК ПриоритетУволен,
	ВЫБОР
		КОГДА МестаРаботыФизлица.ВидЗанятости = ЗНАЧЕНИЕ(Перечисление.ВидыЗанятостиВОрганизации.ОсновноеМестоРаботы)
			ТОГДА 1
		КОГДА МестаРаботыФизлица.ВидЗанятости = ЗНАЧЕНИЕ(Перечисление.ВидыЗанятостиВОрганизации.ВнутреннееСовместительство)
			ТОГДА 2
		ИНАЧЕ 3
	КОНЕЦ КАК ПриоритетВидЗанятости,
	ФИОСрез.Фамилия + " " + ФИОСрез.Имя + " " + ФИОСрез.Отчество КАК ФИО,
	ВЫБОР
		КОГДА МестаРаботыФизлица.ОрганизацияФИН = ЗНАЧЕНИЕ(Справочник.Организации.ПустаяСсылка)
			ТОГДА МестаРаботыФизлица.Организация
		ИНАЧЕ МестаРаботыФизлица.ОрганизацияФИН
	КОНЕЦ КАК Организация,
	МестаРаботыФизлица.Подразделение.Наименование КАК Подразделение,
	МестаРаботыФизлица.Должность КАК Должность,
	КИАдресПроживания.Представление КАК АдресПроживания,
	КИАдресПоПрописке.Представление КАК АдресПоПрописке,
	ЕСТЬNULL(ЛицевойСчетФизлицоОрганизация.НомерЛицевогоСчета, ЛицевойСчетФизлицо.НомерЛицевогоСчета) КАК ЛицевойСчет,
	ВЫБОР
		КОГДА МестаРаботыФизлица.ПричинаИзменения = ЗНАЧЕНИЕ(Перечисление.ПричиныИзмененияСостояния.Увольнение)
			ТОГДА ИСТИНА
		ИНАЧЕ ЛОЖЬ
	КОНЕЦ КАК Уволен,
	ЕСТЬNULL(СтатусыОбходногоЛиста.СтатусОбходногоЛиста, ЗНАЧЕНИЕ(Перечисление.нвСтатусыСогласованияОбходногоЛиста.ПустаяСсылка)) КАК нвСтатусСогласования,
	ЕСТЬNULL(СтатусыОбходногоЛиста.ПредварительнаяДатаУвольнения, ДАТАВРЕМЯ(1, 1, 1, 0, 0, 0)) КАК нвПредполагаемаяДатаУвольнения,
	БейджикиФизлиц.БейджикНомер,
	БейджикиФизлиц.БейджикДействует,
	БейджикиФизлиц.БейджикПроцентСкидки,
	БейджикиФизлиц.БейджикДатаЗаписи
ИЗ
	МестаРаботыФизлица КАК МестаРаботыФизлица
		ЛЕВОЕ СОЕДИНЕНИЕ РегистрСведений.ФИОФизЛиц.СрезПоследних(, ФизЛицо = &amp;Физлицо) КАК ФИОСрез
		ПО МестаРаботыФизлица.Физлицо = ФИОСрез.ФизЛицо
		ЛЕВОЕ СОЕДИНЕНИЕ РегистрСведений.КонтактнаяИнформация КАК КИАдресПроживания
		ПО МестаРаботыФизлица.Физлицо = КИАдресПроживания.Объект
			И (КИАдресПроживания.Вид = ЗНАЧЕНИЕ(Справочник.ВидыКонтактнойИнформации.ФактАдресФизЛица))
		ЛЕВОЕ СОЕДИНЕНИЕ РегистрСведений.КонтактнаяИнформация КАК КИАдресПоПрописке
		ПО МестаРаботыФизлица.Физлицо = КИАдресПоПрописке.Объект
			И (КИАдресПоПрописке.Тип = ЗНАЧЕНИЕ(Перечисление.ТипыКонтактнойИнформации.Адрес))
			И (КИАдресПоПрописке.Вид = ЗНАЧЕНИЕ(Справочник.ВидыКонтактнойИнформации.ЮрАдресФизЛица))
		ЛЕВОЕ СОЕДИНЕНИЕ ЛицевойСчетФизлицоОрганизация КАК ЛицевойСчетФизлицоОрганизация
		ПО МестаРаботыФизлица.Физлицо = ЛицевойСчетФизлицоОрганизация.ФизЛицо
			И МестаРаботыФизлица.Организация = ЛицевойСчетФизлицоОрганизация.Организация
		ЛЕВОЕ СОЕДИНЕНИЕ ЛицевойСчетФизлицо КАК ЛицевойСчетФизлицо
		ПО МестаРаботыФизлица.Физлицо = ЛицевойСчетФизлицо.ФизЛицо
		ЛЕВОЕ СОЕДИНЕНИЕ (ВЫБРАТЬ
			Бейджики.ФизЛицо КАК ФизЛицо,
			Бейджики.НомерКарты КАК БейджикНомер,
			Бейджики.Действует КАК БейджикДействует,
			Бейджики.РазмерСкидки КАК БейджикПроцентСкидки,
			МАКСИМУМ(Бейджики.Период) КАК БейджикДатаЗаписи
		ИЗ
			РегистрСведений.нвБейджики.СрезПоследних(, ФизЛицо = &amp;Физлицо) КАК Бейджики
		
		СГРУППИРОВАТЬ ПО
			Бейджики.НомерКарты,
			Бейджики.Действует,
			Бейджики.ФизЛицо,
			Бейджики.РазмерСкидки) КАК БейджикиФизлиц
		ПО МестаРаботыФизлица.Физлицо = БейджикиФизлиц.ФизЛицо
		ЛЕВОЕ СОЕДИНЕНИЕ (ВЫБРАТЬ
			СтатусыОбходногоЛистаСотрудников.Сотрудник КАК Сотрудник,
			СтатусыОбходногоЛистаСотрудников.СтатусОбходногоЛиста КАК СтатусОбходногоЛиста,
			СтатусыОбходногоЛистаСотрудников.ПредварительнаяДатаУвольнения КАК ПредварительнаяДатаУвольнения
		ИЗ
			РегистрСведений.нвСтатусыОбходногоЛистаСотрудников КАК СтатусыОбходногоЛистаСотрудников
		ГДЕ
			СтатусыОбходногоЛистаСотрудников.Сотрудник В
					(ВЫБРАТЬ
						МестаРаботыФизлица.Сотрудник
					ИЗ
						МестаРаботыФизлица КАК МестаРаботыФизлица)) КАК СтатусыОбходногоЛиста
		ПО МестаРаботыФизлица.Сотрудник = СтатусыОбходногоЛиста.Сотрудник

УПОРЯДОЧИТЬ ПО
	ПриоритетАктуальность,
	ПриоритетУволен,
	ПриоритетВидЗанятости,
	БейджикиФизлиц.БейджикДатаЗаписи УБЫВ
;

////////////////////////////////////////////////////////////////////////////////
ВЫБРАТЬ РАЗЛИЧНЫЕ
	МестаРаботыФизлица.Организация.Наименование КАК НаименованиеОрганизации
ИЗ
	МестаРаботыФизлица КАК МестаРаботыФизлица

УПОРЯДОЧИТЬ ПО
	НаименованиеОрганизации
;

////////////////////////////////////////////////////////////////////////////////
ВЫБРАТЬ РАЗРЕШЕННЫЕ
	КИТелефоны.Представление КАК Телефон
ИЗ
	МестаРаботыФизлица КАК МестаРаботыФизлица
		ЛЕВОЕ СОЕДИНЕНИЕ РегистрСведений.КонтактнаяИнформация КАК КИТелефоны
		ПО МестаРаботыФизлица.Физлицо = КИТелефоны.Объект
			И (КИТелефоны.Тип = ЗНАЧЕНИЕ(Перечисление.ТипыКонтактнойИнформации.Телефон))</Текст>
		</Запрос>
		<Запрос Имя="ПаспортныеДанные" ИспользуетсяПриЗагрузке="false">
			<Текст>ВЫБРАТЬ
	ПаспортныеДанные.ФизЛицо КАК Объект,
	ПаспортныеДанные.ДокументДатаВыдачи КАК ДатаВыдачиПаспорта,
	ПаспортныеДанные.ДатаРегистрацииПоМестуЖительства,
	ПаспортныеДанные.ДокументКодПодразделения,
	ПаспортныеДанные.ДокументКемВыдан КАК КемВыданПаспорт,
	ПаспортныеДанные.ДокументНомер КАК НомерПаспорта,
	ПаспортныеДанные.ДокументСерия КАК СерияПаспорта
ИЗ
	РегистрСведений.ПаспортныеДанныеФизЛиц.СрезПоследних(, ФизЛицо = &amp;ФизЛицо) КАК ПаспортныеДанные</Текст>
		</Запрос>
		<Запрос Имя="СуществуетЗаписьСинхронизации" ИспользуетсяПриЗагрузке="true">
			<Текст>ВЫБРАТЬ ПЕРВЫЕ 1
	СоответствиеСотрудников.Физлицо
ИЗ
	РегистрСведений.СоответствиеСотрудников КАК СоответствиеСотрудников
ГДЕ
	СоответствиеСотрудников.UUID = &amp;UUID</Текст>
		</Запрос>
		<Запрос Имя="СуществуетЗаписьСинхронизацииФизлицо" ИспользуетсяПриЗагрузке="true">
			<Текст>ВЫБРАТЬ ПЕРВЫЕ 1
	СоответствиеСотрудников.UUID
ИЗ
	РегистрСведений.СоответствиеСотрудников КАК СоответствиеСотрудников
ГДЕ
	СоответствиеСотрудников.Физлицо = &amp;Физлицо</Текст>
		</Запрос>
		<Запрос Имя="УзлыПланаОбмена" ИспользуетсяПриЗагрузке="false">
			<Текст>ВЫБРАТЬ
	ВыгрузкаИзКазВЗУП.Ссылка КАК Ссылка
ИЗ
	ПланОбмена.ВыгрузкаИзКазВЗУП КАК ВыгрузкаИзКазВЗУП
ГДЕ
	ВыгрузкаИзКазВЗУП.Ссылка &lt;&gt; &amp;ЭтотУзел</Текст>
		</Запрос>
		<Запрос Имя="УзлыПланаОбменаЗагрузка" ИспользуетсяПриЗагрузке="true">
			<Текст>ВЫБРАТЬ
	ВыгрузкаИзКазВЗУП.Ссылка КАК Ссылка
ИЗ
	ПланОбмена.ВыгрузкаИзКазВЗУП КАК ВыгрузкаИзКазВЗУП
ГДЕ
	ВыгрузкаИзКазВЗУП.Ссылка &lt;&gt; &amp;ЭтотУзел</Текст>
		</Запрос>
		<Запрос Имя="ФизлицаПоляПоиска" ИспользуетсяПриЗагрузке="true">
			<Текст>ВЫБРАТЬ
	СоответствиеСотрудников.Физлицо
ИЗ
	РегистрСведений.СоответствиеСотрудников КАК СоответствиеСотрудников
ГДЕ
	СоответствиеСотрудников.UUID = &amp;UUID</Текст>
		</Запрос>
	</Запросы>
</ПравилаОбмена>